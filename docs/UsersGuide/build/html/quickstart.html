

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2. Workflow Quick Start &mdash; UFS Medium-Range Weather App Users Guide  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3. Code repositories and directory structure" href="repos_and_directories.html" />
    <link rel="prev" title="1. Introduction" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> UFS Medium-Range Weather App Users Guide
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Workflow Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#downloading-the-ufs-mr-weather-app-code-and-scripts">2.1. Downloading the UFS MR Weather App code and scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-configurations">2.2. Model Configurations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#supported-component-sets">2.2.1. Supported component sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#supported-grids">2.2.2. Supported grids</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#setup-the-environment">2.3. Setup the environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-a-case">2.4. Create a case</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-the-case-run-script">2.5. Setting up the case run script</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-the-executable-using-the-case-build-command">2.6. Build the executable using the case.build command</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-the-case">2.7. Run the case</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="repos_and_directories.html">3. Code repositories and directory structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputs_outputs.html">4. Inputs and outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_new_platform.html">5. Configuring a new platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">6. Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">7. FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="cime_overview.html">8. Additional information about CIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">9. Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">UFS Medium-Range Weather App Users Guide</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">2. </span>Workflow Quick Start</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/quickstart.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="workflow-quick-start">
<span id="quickstart"></span><h1><span class="section-number">2. </span>Workflow Quick Start<a class="headerlink" href="#workflow-quick-start" title="Permalink to this headline">¶</a></h1>
<p>The following quick start guide is applicable to versions of the <a class="reference external" href="https://github.com/ufs-community/ufs-mrweather-app">UFS Medium-Range Weather Application</a> that are on preconfigured or configurable machines as listed
<a class="reference external" href="https://github.com/ufs-community/ufs/wiki/Supported-Platforms-and-Compilers">here</a>.</p>
<p>The workflow for building and running the App is built on the CIME
(Common Infrastructure for Modeling Earth) framework.  Please refer to
the <a class="reference external" href="http://esmci.github.io/cime/versions/ufs_release_v1.1/html/users_guide/porting-cime.html">CIME Porting Documentation</a>
if CIME has not yet been ported to the target machine.</p>
<p>If you are new to CIME, please consider reading the <a class="reference external" href="https://esmci.github.io/cime/versions/ufs_release_v1.1/html/users_guide/index.html#case-control-system-part-1-basic-usage">CIME Case Control System Part 1: Basic Usage</a>
<em>after downloading the code</em>.  The CIME Users Guide will be easier to follow after the
directory structure has been created by the <cite>git clone</cite> command.</p>
<p>This is the procedure for quickly setting up and running a case of UFS MR Weather App.</p>
<ul class="simple">
<li><p>Download the UFS MR Weather App</p></li>
<li><p>Create a case: use <code class="docutils literal notranslate"><span class="pre">create_newcase</span></code></p></li>
<li><p>Setup  a case: use <code class="docutils literal notranslate"><span class="pre">case.setup</span></code></p></li>
<li><p>Build  a case: use <code class="docutils literal notranslate"><span class="pre">case.build</span></code></p></li>
<li><p>Run    a case: use <code class="docutils literal notranslate"><span class="pre">case.submit</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Variables presented as <code class="docutils literal notranslate"><span class="pre">$VAR</span></code> in this guide typically refer to variables in XML files
that are created in your case directory. From within a case directory, you can determine the value of such a
variable with <code class="docutils literal notranslate"><span class="pre">./xmlquery</span> <span class="pre">VAR</span></code>. In some instances, <code class="docutils literal notranslate"><span class="pre">$VAR</span></code> refers to a shell
variable or some other variable; we try to make these exceptions clear.</p>
</div>
<div class="section" id="downloading-the-ufs-mr-weather-app-code-and-scripts">
<span id="downloading"></span><h2><span class="section-number">2.1. </span>Downloading the UFS MR Weather App code and scripts<a class="headerlink" href="#downloading-the-ufs-mr-weather-app-code-and-scripts" title="Permalink to this headline">¶</a></h2>
<p>Access to the code requires git. You will need access to the command line clients, <code class="docutils literal notranslate"><span class="pre">git</span></code>
(v1.8 or greater). You can download the latest version of the release
code:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git clone https://github.com/ufs-community/ufs-mrweather-app.git -b ufs-v1.1.0 my_ufs_sandbox</span>
<span class="go">cd my_ufs_sandbox</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When cloning the ufs-mrweather-app repository, the connection to github may time out.  In this
case, resubmit the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span></code> command.</p>
</div>
<p>To checkout UFS MR Weather Model components, including CIME, run the <code class="docutils literal notranslate"><span class="pre">checkout_externals</span></code> script from /path/to/my_ufs_sandbox.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./manage_externals/checkout_externals</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">checkout_externals</span></code> script will read the configuration file <code class="docutils literal notranslate"><span class="pre">Externals.cfg</span></code> and
will download the model source and CIME into /path/to/my_ufs_sandbox.</p>
<p>To see more details regarding the checkout_externals script from the command line, type:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./manage_externals/checkout_externals --help</span>
</pre></div>
</div>
<p>To confirm a successful download of all components, you can run <code class="docutils literal notranslate"><span class="pre">checkout_externals</span></code>
with the status flag to show the status of the externals:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./manage_externals/checkout_externals -S</span>
</pre></div>
</div>
<p>This should show a clean status for all externals, with no characters in the first two
columns of output, as in this example:</p>
<div class="highlight-console notranslate" id="top-level-dir-structure"><div class="highlight"><pre><span></span><span class="go">Checking status of externals: model, stochastic_physics, fv3, ccpp/framework, atmos_cubed_sphere, ccpp/physics, fms, nems, tests/produtil/nceplibs-pyprodutil, fv3gfs_interface, nems_interface, cime,</span>
<span class="go">    ./cime</span>
<span class="go">    ./src/model</span>
<span class="go">    ./src/model/FMS</span>
<span class="go">    ./src/model/FV3</span>
<span class="go">    ./src/model/FV3/atmos_cubed_sphere</span>
<span class="go">    ./src/model/FV3/ccpp/framework</span>
<span class="go">    ./src/model/FV3/ccpp/physics</span>
<span class="go">    ./src/model/FV3/cime</span>
<span class="go">    ./src/model/NEMS</span>
<span class="go">    ./src/model/NEMS/cime/</span>
<span class="go">    ./src/model/NEMS/tests/produtil/NCEPLIBS-pyprodutil</span>
<span class="go">    ./src/model/stochastic_physics</span>
</pre></div>
</div>
<p>You should now have a complete copy of the source code in your /path/to/my_ufs_sandbox.</p>
<p>If there were problems obtaining an external, you might instead see something like:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">e-  ./src/model/FV3</span>
</pre></div>
</div>
<p>This might happen if there was an unexpected interruption while downloading.
First try rerunning <code class="docutils literal notranslate"><span class="pre">./manage_externals/checkout_externals</span></code>.
If there is still a problem, try running with logging turned on using:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./manage_externals/checkout_externals --logging</span>
</pre></div>
</div>
<p>Check the <code class="docutils literal notranslate"><span class="pre">manage_externals.log</span></code> file to see what errors are reported.</p>
</div>
<div class="section" id="model-configurations">
<span id="configurations"></span><h2><span class="section-number">2.2. </span>Model Configurations<a class="headerlink" href="#model-configurations" title="Permalink to this headline">¶</a></h2>
<p>The UFS MR Weather App can be configured at four out-of-the-box
resolutions with two different compsets, <code class="docutils literal notranslate"><span class="pre">GFSv15p2</span></code> or
<code class="docutils literal notranslate"><span class="pre">GFSv16beta</span></code>.  These compsets invoke physics suites that use or not
an ocean-evolving parameterization depending on the initial data
provided. See the Introduction for more information on the physics
suites provided with the release and see the frequently-asked
questions (<a class="reference internal" href="faq.html#faq"><span class="std std-ref">FAQ</span></a>) section for more information on compsets,
physics suites, and initial datasets.</p>
<ul class="simple">
<li><p>Details of available component sets and resolutions are available from the <code class="docutils literal notranslate"><span class="pre">query_config</span></code> tool located in the <code class="docutils literal notranslate"><span class="pre">cime/scripts</span></code> directory</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd $SRCROOT/cime/scripts</span>
<span class="go">./query_config --help</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">$SRCROOT</span></code> is the top directory of the ufs-mrweather-app.</p>
<div class="section" id="supported-component-sets">
<span id="supported-compsets"></span><h3><span class="section-number">2.2.1. </span>Supported component sets<a class="headerlink" href="#supported-component-sets" title="Permalink to this headline">¶</a></h3>
<p>The components of the modeling system can be combined in numerous ways to carry out various scientific or
software experiments. A particular mix of components, along with component-specific configuration and/or
namelist settings is referred to as  component set or “compset”. The UFS MR Weather App
has a shorthand naming convention for component sets that are supported out-of-the-box.</p>
<p>To determine what MR Weather App compsets are available in the release, use
the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd $SRCROOT/cime/scripts</span>
<span class="go">./query_config --compsets</span>
</pre></div>
</div>
<p>This should show a list of available compsets:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Active component: ufsatm</span>
<span class="go">       --------------------------------------</span>
<span class="go">       Compset Alias: Compset Long Name</span>
<span class="go">       --------------------------------------</span>
<span class="go">   GFSv15p2             : FCST_ufsatm%v15p2_SLND_SICE_SOCN_SROF_SGLC_SWAV</span>
<span class="go">   GFSv16beta           : FCST_ufsatm%v16beta_SLND_SICE_SOCN_SROF_SGLC_SWAV</span>
</pre></div>
</div>
</div>
<div class="section" id="supported-grids">
<span id="id1"></span><h3><span class="section-number">2.2.2. </span>Supported grids<a class="headerlink" href="#supported-grids" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="glossary.html#term-CIME"><span class="xref std std-term">CIME</span></a> has the flexibility to support numerous model resolutions.
To see the grids that are currently supported, use the following command</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd $SRCROOT/cime/scripts</span>
<span class="go">./query_config --grids</span>
</pre></div>
</div>
<p>This should show the a list of available grids for this release.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">=========================================</span>
<span class="go">GRID naming convention</span>
<span class="go">=========================================</span>
<span class="go">The notation for the grid longname is</span>
<span class="go">    a%name_l%name_oi%name_r%name_m%mask_g%name_w%name</span>
<span class="go">where</span>
<span class="go">    a% =&gt; atm, l% =&gt; lnd, oi% =&gt; ocn/ice, r% =&gt; river, m% =&gt; mask, g% =&gt; glc, w% =&gt; wav</span>

<span class="go">Supported grid configurations are given via alias specification in</span>
<span class="go">the file &quot;config_grids.xml&quot;. Each grid alias can also be associated  with the</span>
<span class="go">following optional attributes</span>

<span class="go"> -------------------------------------------------------------</span>
<span class="go">        default component grids:</span>

<span class="go"> component         compset       value</span>
<span class="go"> -------------------------------------------------------------</span>
<span class="go"> atm      SATM              null</span>
<span class="go"> lnd      SLND              null</span>
<span class="go"> ocnice   SOCN              null</span>
<span class="go"> rof      SROF              null</span>
<span class="go"> glc      SGLC              null</span>
<span class="go"> wav      SWAV              null</span>
<span class="go"> iac      SIAC              null</span>
<span class="go"> -------------------------------------------------------------</span>

<span class="go"> alias: C96</span>
<span class="go">   non-default grids are: atm:C96</span>

<span class="go"> alias: C192</span>
<span class="go">   non-default grids are: atm:C192</span>

<span class="go"> alias: C384</span>
<span class="go">   non-default grids are: atm:C384</span>

<span class="go"> alias: C768</span>
<span class="go">   non-default grids are: atm:C768</span>
</pre></div>
</div>
<p>As can be seen, MR Weather App currently supports four grids with the following nominal resolutions</p>
<ul class="simple">
<li><p>C96 (~100km)</p></li>
<li><p>C192 (~50km),</p></li>
<li><p>C384 (~25km)</p></li>
<li><p>C768 (~13km),</p></li>
</ul>
<p>and all with 64 vertical levels.</p>
</div>
</div>
<div class="section" id="setup-the-environment">
<h2><span class="section-number">2.3. </span>Setup the environment<a class="headerlink" href="#setup-the-environment" title="Permalink to this headline">¶</a></h2>
<p>Two environment variables need to be set prior to running the CIME workflow:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export UFS_INPUT=/path/to/inputs</span>
<span class="go">export UFS_SCRATCH=/path/to/outputs</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">UFS_INPUT</span></code> should be set to the location of a folder where input
data will be accessed.  There should be a folder named
<code class="docutils literal notranslate"><span class="pre">ufs_inputdata</span></code> underneath this folder.  The folder
<code class="docutils literal notranslate"><span class="pre">$UFS_INPUT/ufs_inputdata</span></code> should exist before running the CIME
workflow. This is often a shared location on a platform so that all
users on that platform can access data from the same location.</p>
<p><code class="docutils literal notranslate"><span class="pre">UFS_SCRATCH</span></code> should be set to the location of a writeable folder
where output will be written for each case.  This is typically a user
scratch space or temporary location with a large allocation available.</p>
<p>The following settings are recommended on the pre-configured platforms:</p>
<table class="docutils align-default" id="id3">
<caption><span class="caption-number">Table 2.1 </span><span class="caption-text">Path settings for pre-configured platforms.</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 23%" />
<col style="width: 44%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Platform</strong></p></th>
<th class="head"><p><strong>$UFS_INPUT</strong></p></th>
<th class="head"><p><strong>$UFS_SCRATCH</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NCAR cheyenne</p></td>
<td><p>$CESMDATAROOT</p></td>
<td><p>/glade/scratch/$USER</p></td>
</tr>
<tr class="row-odd"><td><p>NOAA hera</p></td>
<td><p>/scratch1/NCEPDEV/stmp2/CIME_UFS</p></td>
<td><p>&lt;my-project-dir&gt;/$USER</p></td>
</tr>
</tbody>
</table>
<p>On <a class="reference external" href="https://github.com/ufs-community/ufs/wiki/Supported-Platforms-and-Compilers">platforms that are not pre-configured</a> a script needs to be executed to define a set of environment variables related to the location of NCEPLIBS dependencies.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> SH or BASH shells
<span class="go">source $NCEPLIBS_DIR/bin/setenv_nceplibs.sh</span>

<span class="gp">#</span> CSH or TCSH shells
<span class="go">source $NCEPLIBS_DIR/bin/setenv_nceplibs.csh</span>
</pre></div>
</div>
<p>The recommended best practice to set the <code class="docutils literal notranslate"><span class="pre">$UFS_SCRATCH</span></code> and
<code class="docutils literal notranslate"><span class="pre">$UFS_INPUT</span></code> environment variables and source the NCEPLIBS provided
shell script <code class="docutils literal notranslate"><span class="pre">setenv_nceplibs.sh|.csh</span></code> is to add the above commands
to a startup script such as <code class="docutils literal notranslate"><span class="pre">$HOME/.bashrc</span></code> (Bash shell) or
<code class="docutils literal notranslate"><span class="pre">$HOME/.tcshrc</span></code> (Tcsh shell). These files are executed automatically
when you start a new shell so that you do not need to re-define them
during each login.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>On some platforms (in particular Stampede2) this practice is <strong>required</strong> to ensure the
environment variables are properly set on compute nodes accessed by the workflow.</p>
</div>
</div>
<div class="section" id="create-a-case">
<h2><span class="section-number">2.4. </span>Create a case<a class="headerlink" href="#create-a-case" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://esmci.github.io/cime/versions/ufs_release_v1.1/html/users_guide/create-a-case.html">create_newcase</a> command creates a case directory containing the scripts and XML
files to configure a case (see below) for the requested resolution, component set, and
machine. <code class="docutils literal notranslate"><span class="pre">create_newcase</span></code> has three required arguments: <code class="docutils literal notranslate"><span class="pre">--case</span></code>, <code class="docutils literal notranslate"><span class="pre">--compset</span></code> and
<code class="docutils literal notranslate"><span class="pre">--res</span></code>.   The <code class="docutils literal notranslate"><span class="pre">workflow</span></code> argument is optional, to select alternate workflow components (see below).
The <code class="docutils literal notranslate"><span class="pre">project</span></code> argument is optional, to set the batch system project account (see below).
(invoke <code class="docutils literal notranslate"><span class="pre">create_newcase</span> <span class="pre">--help</span></code> for help).</p>
<p>On machines where a project or account code is needed, you
must either specify the <code class="docutils literal notranslate"><span class="pre">--project</span> <span class="pre">$PROJECT</span></code> argument in the <code class="docutils literal notranslate"><span class="pre">create_newcase</span></code> command, or set the
<code class="docutils literal notranslate"><span class="pre">$PROJECT</span></code> variable in your shell environment.  If this argument is not set, the default value in config_machines.xml for <code class="docutils literal notranslate"><span class="pre">$PROJECT</span></code></p>
<blockquote>
<div><p>will be used. An error will be reported if the default project account is not accessable.</p>
</div></blockquote>
<p>If running on a preconfigured or configurable machine, that machine
will normally be recognized automatically and therefore it is not
required to specify the –machine argument to create_newcase. Generic linux and
macos systems will require the <code class="docutils literal notranslate"><span class="pre">--machine</span></code> argument to be used.</p>
<p>Invoke <code class="docutils literal notranslate"><span class="pre">create_newcase</span></code> as follows from the <code class="docutils literal notranslate"><span class="pre">cime/scripts</span></code> directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd cime/scripts</span>
<span class="go">./create_newcase --case CASENAME --compset COMPSET --res GRID --workflow WORKFLOW</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CASENAME</span></code> defines the name of your case (stored in the <code class="docutils literal notranslate"><span class="pre">$CASE</span></code> XML variable). This
is a very important piece of metadata that will be used in filenames, internal metadata
and directory paths. <code class="docutils literal notranslate"><span class="pre">create_newcase</span></code> will create the <em>case directory</em> with the same
name as the <code class="docutils literal notranslate"><span class="pre">CASENAME</span></code>. If <code class="docutils literal notranslate"><span class="pre">CASENAME</span></code> is simply a name (not a path), the case
directory is created in the <code class="docutils literal notranslate"><span class="pre">cime/scripts</span></code> directory where you executed create_newcase.
If <code class="docutils literal notranslate"><span class="pre">CASENAME</span></code> is a relative or absolute path, the case directory is created there and the name of the
case will be the tail path. The full path to the case directory will be
stored in the <code class="docutils literal notranslate"><span class="pre">$CASEROOT</span></code> XML variable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPSET</span></code> is the component set and can be <code class="docutils literal notranslate"><span class="pre">GFSv15p2</span></code> or <code class="docutils literal notranslate"><span class="pre">GFSv16beta</span></code>, which trigger
supported Common Community Physics Package (CCPP) suites. If you would like to learn more about CCPP
please consider reading the <a class="reference external" href="https://ccpp-techdoc.readthedocs.io/en/latest/Overview.html">CCPP Overview</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRID</span></code> is the model resolution, which can be <code class="docutils literal notranslate"><span class="pre">C96</span></code>, <code class="docutils literal notranslate"><span class="pre">C192</span></code>, <code class="docutils literal notranslate"><span class="pre">C384</span></code> and <code class="docutils literal notranslate"><span class="pre">C768</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WORKFLOW</span></code> is the workflow and can be set as <code class="docutils literal notranslate"><span class="pre">ufs-mrweather</span></code> or <code class="docutils literal notranslate"><span class="pre">ufs-mrweather_wo_post</span></code>. The
<code class="docutils literal notranslate"><span class="pre">ufs-mrweather</span></code> includes both pre- and post-processing steps, while <code class="docutils literal notranslate"><span class="pre">ufs-mrweather_wo_post</span></code> includes
only pre-processing step. In the current version of the UFS MR Weather App, the
pre-processing step need to be run to generate initial conditions for the UFS Weather Model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PROJECT</span></code> is the project or account code needed to run batch jobs. You
may either specify the <code class="docutils literal notranslate"><span class="pre">--project</span> <span class="pre">$PROJECT</span></code> argument in the <code class="docutils literal notranslate"><span class="pre">create_newcase</span></code> command, or set the
<code class="docutils literal notranslate"><span class="pre">$PROJECT</span></code> variable in your shell environment.</p></li>
</ul>
<p>Here is an example on NCAR machine Cheyenne with the <code class="docutils literal notranslate"><span class="pre">$USER</span></code> shell environment variable
set to your Cheyenne login name:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd cime/scripts</span>
<span class="go">./create_newcase --case $UFS_SCRATCH/ufs-mrweather-app-workflow.c96 --compset GFSv15p2 --res C96 --workflow ufs-mrweather</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-the-case-run-script">
<h2><span class="section-number">2.5. </span>Setting up the case run script<a class="headerlink" href="#setting-up-the-case-run-script" title="Permalink to this headline">¶</a></h2>
<p>Issuing the <a class="reference external" href="http://esmci.github.io/cime/versions/ufs_release_v1.1/html/users_guide/setting-up-a-case.html">case.setup</a> command creates scripts needed to run the model
along with namelist <code class="docutils literal notranslate"><span class="pre">user_nl_xxx</span></code> files, where xxx denotes the set of components
for the given case configuration such as <code class="docutils literal notranslate"><span class="pre">ufsatm</span></code> and <code class="docutils literal notranslate"><span class="pre">cpl</span></code>.
Selected namelist entries can be customized by editing <code class="docutils literal notranslate"><span class="pre">user_nl_xxx</span></code>, see <a class="reference internal" href="faq.html#faq"><span class="std std-ref">FAQ</span></a>.</p>
<p>cd to the case directory or case root (<code class="docutils literal notranslate"><span class="pre">$CASEROOT</span></code>) <code class="docutils literal notranslate"><span class="pre">$UFS_SCRATCH/ufs-mrweather-app-workflow.c96</span></code> as shown above:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd /glade/scratch/$USER/cases/ufs-mrweather-app-workflow.c96</span>
</pre></div>
</div>
<p>Before invoking <code class="docutils literal notranslate"><span class="pre">case.setup</span></code>, you could modify the <code class="docutils literal notranslate"><span class="pre">env_mach_pes.xml</span></code> file in the case directory
using the <a class="reference external" href="http://esmci.github.io/cime/versions/ufs_release_v1.1/html/Tools_user/xmlchange.html">xmlchange</a> command as needed for the experiment (optional). (Note: To edit any of
the env xml files, use the <a class="reference external" href="http://esmci.github.io/cime/versions/ufs_release_v1.1/html/Tools_user/xmlchange.html">xmlchange</a> command. <code class="docutils literal notranslate"><span class="pre">xmlchange</span> <span class="pre">--help</span></code> can be used for help.)</p>
<p>Please also be aware that you need to provide consistent <code class="docutils literal notranslate"><span class="pre">layout</span></code>, <code class="docutils literal notranslate"><span class="pre">write_tasks_per_group</span></code> and
<code class="docutils literal notranslate"><span class="pre">write_groups</span></code> namelist options to the model when total number of PEs are changed.</p>
<p>Invoke the <code class="docutils literal notranslate"><span class="pre">case.setup</span></code> command.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./case.setup</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The CIME commands <code class="docutils literal notranslate"><span class="pre">./xmlquery</span></code>, <code class="docutils literal notranslate"><span class="pre">./case.setup</span></code>, <code class="docutils literal notranslate"><span class="pre">./case.build</span></code>, <code class="docutils literal notranslate"><span class="pre">./case.submit</span></code> examine and modify
the CIME case, and so, are linked into the directory specified by <code class="docutils literal notranslate"><span class="pre">--case</span></code> when the <code class="docutils literal notranslate"><span class="pre">./create_newcase</span></code> is run.  They should be run from this case directory.</p>
</div>
</div>
<div class="section" id="build-the-executable-using-the-case-build-command">
<h2><span class="section-number">2.6. </span>Build the executable using the case.build command<a class="headerlink" href="#build-the-executable-using-the-case-build-command" title="Permalink to this headline">¶</a></h2>
<p>Modify build settings in <code class="docutils literal notranslate"><span class="pre">env_build.xml</span></code> (optional).</p>
<p>Run the build script.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./case.build</span>
</pre></div>
</div>
<p>Users of the NCAR cheyenne system should consider using
<a class="reference external" href="https://www2.cisl.ucar.edu/resources/computational-systems/cheyenne/running-jobs/submitting-jobs-pbs">qcmd</a>
to compile UFS Weather Model on a compute node as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">qcmd -- ./case.build</span>
</pre></div>
</div>
<p>The UFS Weather Model executable (named as <code class="docutils literal notranslate"><span class="pre">ufs.exe</span></code>) will appear in the directory given by the
XML variable <code class="docutils literal notranslate"><span class="pre">$EXEROOT</span></code>, which can be queried using:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./xmlquery EXEROOT</span>
</pre></div>
</div>
</div>
<div class="section" id="run-the-case">
<span id="id2"></span><h2><span class="section-number">2.7. </span>Run the case<a class="headerlink" href="#run-the-case" title="Permalink to this headline">¶</a></h2>
<p>Modify runtime settings in <code class="docutils literal notranslate"><span class="pre">env_run.xml</span></code> (optional). Two settings you may want to change
now are:</p>
<ol class="arabic">
<li><p>Run length: By default, the model is set to run for 5 days based on the <code class="docutils literal notranslate"><span class="pre">$STOP_N</span></code> and
<code class="docutils literal notranslate"><span class="pre">$STOP_OPTION</span></code> variables:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./xmlquery STOP_OPTION,STOP_N</span>
</pre></div>
</div>
<p>These default settings can be useful in <a class="reference external" href="http://esmci.github.io/cime/versions/ufs_release_v1.1/html/users_guide/troubleshooting.html">troubleshooting</a> runtime problems
before submitting for a longer time or a production runs. For example, following setting can be used to
set the simulation lenght to 36-hours. Please, also be aware that <code class="docutils literal notranslate"><span class="pre">nyears</span></code>, <code class="docutils literal notranslate"><span class="pre">nmonths</span></code> and <code class="docutils literal notranslate"><span class="pre">nsteps</span></code>
options for <code class="docutils literal notranslate"><span class="pre">STOP_OPTION</span></code> are not supported in the UFS MR Weather App.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./xmlchange STOP_OPTION=nhours,STOP_N=36</span>
</pre></div>
</div>
</li>
<li><p>You can set the <code class="docutils literal notranslate"><span class="pre">$DOUT_S</span></code> variable to FALSE to turn off short term archiving:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./xmlchange DOUT_S=FALSE</span>
</pre></div>
</div>
</li>
<li><p>The default job wall clock time, which is set to 12-hours, can be changed for relatively short and
low-resolution simulations. For example, following commands sets the job wall clock time to 30-minutes.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./xmlchange JOB_WALLCLOCK_TIME=00:30:00</span>
<span class="go">./xmlchange USER_REQUESTED_WALLTIME=00:30:00</span>
</pre></div>
</div>
</li>
<li><p>The default start date (2019-08-29, 00 UTC) can be also changed by following commands</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./xmlchange RUN_STARTDATE=YYYY-MM-DD</span>
<span class="go">./xmlchange START_TOD=AS_SECOND</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RUN_STARTDATE</span></code> is the start date and need to be given in YYYY-MM-DD format such as 2020-01-15</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">START_TOD</span></code> is the time of day in seconds such as 12 UTC need to be given as 43200 seconds.</p></li>
</ul>
</li>
</ol>
<p>Submit the job to the batch queue using the <code class="docutils literal notranslate"><span class="pre">case.submit</span></code> command.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./case.submit</span>
</pre></div>
</div>
<p>Based on the selected workflow (<code class="docutils literal notranslate"><span class="pre">ufs-mrweather</span></code> or <code class="docutils literal notranslate"><span class="pre">ufs-mrweather_wo_post</span></code>), the <code class="docutils literal notranslate"><span class="pre">case.submit</span></code>
command submits a chain of jobs that their dependency is automatically set. For example, <code class="docutils literal notranslate"><span class="pre">ufs-mrweather</span></code>
workflow submits a job array with three seperate jobs that will run in an order: pre-processing, simulation
and post-processing.  The first ten characters of the job names will be <code class="docutils literal notranslate"><span class="pre">chgres.ufs</span></code>, <code class="docutils literal notranslate"><span class="pre">run.ufs-mr</span></code>, and
<code class="docutils literal notranslate"><span class="pre">gfs_post.u</span></code>, respectively.</p>
<p>When the jobs are complete, most output will <em>NOT</em> be written under the case directory, but
instead under some other directories (defined by $UFS_SCRATCH).
Review the following directories and files, whose
locations can be found with <code class="docutils literal notranslate"><span class="pre">xmlquery</span></code> (note: <code class="docutils literal notranslate"><span class="pre">xmlquery</span></code> can be run with a list of
comma separated names and no spaces):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./xmlquery RUNDIR,CASE,CASEROOT,DOUT_S,DOUT_S_ROOT</span>
</pre></div>
</div>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">$RUNDIR</span></code></p>
<p>This directory is set in the <code class="docutils literal notranslate"><span class="pre">env_run.xml</span></code> file. This is the
location where UFS MR Weather App was run. Log files for each stage of the workflow can be found here.</p>
</li>
</ul>
<table class="docutils align-default" id="id4">
<caption><span class="caption-number">Table 2.2 </span><span class="caption-text">Log files</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 23%" />
<col style="width: 41%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Component</strong></p></th>
<th class="head"><p><strong>File Name</strong></p></th>
<th class="head"><p><strong>Look for…</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>chgres.ufs</p></td>
<td><p>chgres_cube.yymmdd-hhmmss.log</p></td>
<td><p>“DONE”</p></td>
</tr>
<tr class="row-odd"><td><p>run.ufs-mr</p></td>
<td><p>ufs.log.&lt;jobid&gt;.yymmdd-hhmmss</p></td>
<td><p>“PROGRAM nems HAS ENDED”</p></td>
</tr>
<tr class="row-even"><td><p>gfs_post.ufs</p></td>
<td><p>oi.hhh</p></td>
<td><p>“PROGRAM UNIFIED_POST HAS ENDED”</p></td>
</tr>
</tbody>
</table>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">$DOUT_S_ROOT/$CASE</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$DOUT_S_ROOT</span></code> refers to the short term archive path location on local disk.
This path is used by the case.st_archive script when <code class="docutils literal notranslate"><span class="pre">$DOUT_S</span> <span class="pre">=</span> <span class="pre">TRUE</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">$DOUT_S_ROOT/$CASE</span></code> is the short term archive directory for this case. If <code class="docutils literal notranslate"><span class="pre">$DOUT_S</span></code> is
FALSE, then no archive directory should exist. If <code class="docutils literal notranslate"><span class="pre">$DOUT_S</span></code> is TRUE, then
log, history, and restart files should have been copied into a directory
tree here.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">$DOUT_S_ROOT/$CASE/logs</span></code></p>
<p>The log files should have been copied into this directory if the run completed successfully
and the short-term archiver is turned on with <code class="docutils literal notranslate"><span class="pre">$DOUT_S</span> <span class="pre">=</span> <span class="pre">TRUE</span></code>. Otherwise, the log files
are in the <code class="docutils literal notranslate"><span class="pre">$RUNDIR</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">$CASEROOT</span></code></p>
<p>There could be standard out and/or standard error files output from the batch system.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">$CASEROOT/CaseDocs</span></code></p>
<p>The case namelist files are copied into this directory from the <code class="docutils literal notranslate"><span class="pre">$RUNDIR</span></code>.</p>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="repos_and_directories.html" class="btn btn-neutral float-right" title="3. Code repositories and directory structure" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral float-left" title="1. Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>